{"version":3,"sources":["file:///C:/Users/trung/Desktop/Subject/cong-cu-moi-truong-phat-trien-phan-mem/game_doi_khang_multiphayer_socket_cocos_creator_nodejs/assets/KylinsEasyController/UI_Joystick.ts"],"names":["_decorator","Component","UITransform","Input","KeyCode","input","director","EasyControllerEvent","ccclass","property","UI_Joystick","_ctrlRoot","_ctrlPointer","_checkerCamera","_cameraSensitivity","_distanceOfTwoTouchPoint","_movementTouch","_cameraTouchA","_cameraTouchB","_scene","_keys","_degree","key2dirMap","start","checkerCamera","node","getChildByName","getComponent","on","EventType","TOUCH_START","onTouchStart_CameraCtrl","TOUCH_MOVE","onTouchMove_CameraCtrl","TOUCH_END","onTouchUp_CameraCtrl","TOUCH_CANCEL","checkerMovement","onTouchStart_Movement","onTouchMove_Movement","onTouchUp_Movement","active","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","MOUSE_WHEEL","onMouseWheel","getScene","onDestroy","off","event","touches","getTouches","i","length","touch","x","getUILocationX","y","getUILocationY","halfWidth","width","halfHeight","height","setPosition","getID","pos","position","ox","oy","len","Math","sqrt","dirX","dirY","radius","degree","atan","PI","emit","MOVEMENT","MOVEMENT_STOP","getDistOfTwoTouchPoints","touchA","touchB","dx","getLocationX","dy","getLocationY","getAllTouches","touchID","console","log","needZoom","newDist","delta","CAMERA_ZOOM","dt","getDelta","rx","ry","CAMERA_ROTATE","hasTouchA","hasTouchB","keyCode","KEY_A","KEY_S","KEY_D","KEY_W","indexOf","push","updateDirection","SPACE","JUMP","index","splice","getScrollY","keyCode0","keyCode1"],"mappings":"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","sourcesContent":["import { _decorator, Node, EventTouch, Touch, Component, UITransform, Input, EventKeyboard, KeyCode, v2, Vec3, input, Scene, director, EventMouse, macro, view, screen } from 'cc';\r\nimport { EasyControllerEvent } from './EasyController';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/****\r\n * split screen into three parts.\r\n * ---------------------------------------------\r\n *                                              |\r\n *           1.camera rotation zone             |\r\n *                                              |\r\n *----------------------------------------------|\r\n *                      |                       |\r\n * 2.movment ctrl zone  | 3.camera rotation zone|\r\n *                      |                       |\r\n * ----------------------------------------------\r\n * \r\n * multi-touch for camera zoom.\r\n *  */\r\n\r\n@ccclass('UI_Joystick')\r\nexport class UI_Joystick extends Component {\r\n\r\n\r\n    private _ctrlRoot: UITransform = null;\r\n    private _ctrlPointer: Node = null;\r\n    private _checkerCamera: UITransform = null;\r\n\r\n    private _cameraSensitivity: number = 0.1;\r\n    private _distanceOfTwoTouchPoint: number = 0;\r\n\r\n    private _movementTouch: Touch = null;\r\n    private _cameraTouchA: Touch = null;\r\n    private _cameraTouchB: Touch = null;\r\n\r\n    private _scene: Scene = null;\r\n\r\n    start() {\r\n        let checkerCamera = this.node.getChildByName('checker_camera').getComponent(UITransform);\r\n        checkerCamera.node.on(Input.EventType.TOUCH_START, this.onTouchStart_CameraCtrl, this);\r\n        checkerCamera.node.on(Input.EventType.TOUCH_MOVE, this.onTouchMove_CameraCtrl, this);\r\n        checkerCamera.node.on(Input.EventType.TOUCH_END, this.onTouchUp_CameraCtrl, this);\r\n        checkerCamera.node.on(Input.EventType.TOUCH_CANCEL, this.onTouchUp_CameraCtrl, this);\r\n\r\n        let checkerMovement = this.node.getChildByName('checker_movement').getComponent(UITransform);\r\n        checkerMovement.node.on(Input.EventType.TOUCH_START, this.onTouchStart_Movement, this);\r\n        checkerMovement.node.on(Input.EventType.TOUCH_MOVE, this.onTouchMove_Movement, this);\r\n        checkerMovement.node.on(Input.EventType.TOUCH_END, this.onTouchUp_Movement, this);\r\n        checkerMovement.node.on(Input.EventType.TOUCH_CANCEL, this.onTouchUp_Movement, this);\r\n\r\n\r\n        this._checkerCamera = checkerCamera;\r\n\r\n        this._ctrlRoot = this.node.getChildByName('ctrl').getComponent(UITransform);\r\n        this._ctrlRoot.node.active = false;\r\n        this._ctrlPointer = this._ctrlRoot.node.getChildByName('pointer');\r\n\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        input.on(Input.EventType.MOUSE_WHEEL,this.onMouseWheel, this);\r\n\r\n        this._scene = director.getScene();\r\n    }\r\n\r\n    onDestroy() {\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n        input.off(Input.EventType.MOUSE_WHEEL,this.onMouseWheel, this);\r\n    }\r\n\r\n    onTouchStart_Movement(event: EventTouch) {\r\n        let touches = event.getTouches();\r\n        for (let i = 0; i < touches.length; ++i) {\r\n            let touch = touches[i];\r\n            let x = touch.getUILocationX();\r\n            let y = touch.getUILocationY();\r\n            if (!this._movementTouch) {\r\n                //we sub halfWidth,halfHeight here.\r\n                //because, the touch event use left bottom as zero point(0,0), ui node use the center of screen as zero point(0,0)\r\n                //this._ctrlRoot.setPosition(x - halfWidth, y - halfHeight, 0);\r\n\r\n                let halfWidth = this._checkerCamera.width / 2;\r\n                let halfHeight = this._checkerCamera.height / 2;\r\n\r\n                this._ctrlRoot.node.active = true;\r\n                this._ctrlRoot.node.setPosition(x - halfWidth, y - halfHeight, 0);\r\n                this._ctrlPointer.setPosition(0, 0, 0);\r\n                this._movementTouch = touch;\r\n            }\r\n        }\r\n    }\r\n\r\n    onTouchMove_Movement(event: EventTouch) {\r\n        let touches = event.getTouches();\r\n        for (let i = 0; i < touches.length; ++i) {\r\n            let touch = touches[i];\r\n            if (this._movementTouch && touch.getID() == this._movementTouch.getID()) {\r\n                let halfWidth = this._checkerCamera.width / 2;\r\n                let halfHeight = this._checkerCamera.height / 2;\r\n                let x = touch.getUILocationX();\r\n                let y = touch.getUILocationY();\r\n\r\n                let pos = this._ctrlRoot.node.position;\r\n                let ox = x - halfWidth - pos.x;\r\n                let oy = y - halfHeight - pos.y;\r\n\r\n                let len = Math.sqrt(ox * ox + oy * oy);\r\n                if (len <= 0) {\r\n                    return;\r\n                }\r\n\r\n                let dirX = ox / len;\r\n                let dirY = oy / len;\r\n                let radius = this._ctrlRoot.width / 2;\r\n                if (len > radius) {\r\n                    len = radius;\r\n                    ox = dirX * radius;\r\n                    oy = dirY * radius;\r\n                }\r\n\r\n                this._ctrlPointer.setPosition(ox, oy, 0);\r\n\r\n                // degree 0 ~ 360 based on x axis.\r\n                let degree = Math.atan(dirY / dirX) / Math.PI * 180;\r\n                if (dirX < 0) {\r\n                    degree += 180;\r\n                }\r\n                else {\r\n                    degree += 360;\r\n                }\r\n\r\n                this._scene.emit(EasyControllerEvent.MOVEMENT, degree, len / radius);\r\n            }\r\n        }\r\n    }\r\n\r\n    onTouchUp_Movement(event: EventTouch) {\r\n        let touches = event.getTouches();\r\n        for (let i = 0; i < touches.length; ++i) {\r\n            let touch = touches[i];\r\n            if (this._movementTouch && touch.getID() == this._movementTouch.getID()) {\r\n                this._scene.emit(EasyControllerEvent.MOVEMENT_STOP);\r\n                this._movementTouch = null;\r\n                this._ctrlRoot.node.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private getDistOfTwoTouchPoints(): number {\r\n        let touchA = this._cameraTouchA;\r\n        let touchB = this._cameraTouchB;\r\n        if (!touchA || !touchB) {\r\n            return 0;\r\n        }\r\n        let dx = touchA.getLocationX() - touchB.getLocationX();\r\n        let dy = touchB.getLocationY() - touchB.getLocationY();\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n    \r\n    private onTouchStart_CameraCtrl(event: EventTouch) {\r\n        let touches = event.getAllTouches();\r\n        this._cameraTouchA = null;\r\n        this._cameraTouchB = null;\r\n        for (let i = touches.length - 1; i >= 0; i--) {\r\n            let touch = touches[i];\r\n            if (this._movementTouch && touch.getID() == this._movementTouch.getID()) {\r\n                continue;\r\n            }\r\n            if (this._cameraTouchA == null) {\r\n                this._cameraTouchA = touches[i];\r\n            }\r\n            else if (this._cameraTouchB == null) {\r\n                this._cameraTouchB = touches[i];\r\n                break;\r\n            }\r\n        }\r\n        this._distanceOfTwoTouchPoint = this.getDistOfTwoTouchPoints();\r\n    }\r\n\r\n    private onTouchMove_CameraCtrl(event: EventTouch) {\r\n        let touches = event.getTouches();\r\n        for (let i = 0; i < touches.length; ++i) {\r\n            let touch = touches[i];\r\n            let touchID = touch.getID();\r\n            //two touches, do camera zoom.\r\n            if (this._cameraTouchA && this._cameraTouchB) {\r\n                console.log(touchID, this._cameraTouchA.getID(), this._cameraTouchB.getID());\r\n                let needZoom = false;\r\n                if (touchID == this._cameraTouchA.getID()) {\r\n                    this._cameraTouchA = touch;\r\n                    needZoom = true;\r\n                }\r\n                if (touchID == this._cameraTouchB.getID()) {\r\n                    this._cameraTouchB = touch;\r\n                    needZoom = true;\r\n                }\r\n\r\n                if (needZoom) {\r\n                    let newDist = this.getDistOfTwoTouchPoints();\r\n                    let delta = this._distanceOfTwoTouchPoint - newDist;\r\n                    this._scene.emit(EasyControllerEvent.CAMERA_ZOOM, delta);\r\n                    this._distanceOfTwoTouchPoint = newDist;\r\n                }\r\n            }\r\n            //only one touch, do camera rotate.\r\n            else if (this._cameraTouchA && touchID == this._cameraTouchA.getID()) {\r\n                let dt = touch.getDelta();\r\n                let rx = dt.y * this._cameraSensitivity;\r\n                let ry = -dt.x * this._cameraSensitivity;\r\n                this._scene.emit(EasyControllerEvent.CAMERA_ROTATE, rx, ry);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onTouchUp_CameraCtrl(event: EventTouch) {\r\n        let touches = event.getAllTouches();\r\n        let hasTouchA = false;\r\n        let hasTouchB = false;\r\n        for (let i = 0; i < touches.length; ++i) {\r\n            let touch = touches[i];\r\n            let touchID = touch.getID();\r\n            if (this._cameraTouchA && touchID == this._cameraTouchA.getID()) {\r\n                hasTouchA = true;\r\n            }\r\n            else if (this._cameraTouchB && touchID == this._cameraTouchB.getID()) {\r\n                hasTouchB = true;\r\n            }\r\n        }\r\n\r\n        if (!hasTouchA) {\r\n            this._cameraTouchA = null;\r\n        }\r\n        if (!hasTouchB) {\r\n            this._cameraTouchB = null;\r\n        }\r\n    }\r\n\r\n    private _keys = [];\r\n    private _degree: number = 0;\r\n\r\n    onKeyDown(event: EventKeyboard) {\r\n        let keyCode = event.keyCode;\r\n        if (keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W) {\r\n            if (this._keys.indexOf(keyCode) == -1) {\r\n                this._keys.push(keyCode);\r\n                this.updateDirection();\r\n            }\r\n        }\r\n\r\n        if(keyCode == KeyCode.SPACE){\r\n            this._scene.emit(EasyControllerEvent.JUMP);\r\n        }\r\n    }\r\n\r\n    onKeyUp(event: EventKeyboard) {\r\n        let keyCode = event.keyCode;\r\n        if (keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W) {\r\n            let index = this._keys.indexOf(keyCode);\r\n            if (index != -1) {\r\n                this._keys.splice(index, 1);\r\n                this.updateDirection();\r\n            }\r\n        }\r\n    }\r\n\r\n    onMouseWheel(event:EventMouse){\r\n        let delta = event.getScrollY() * 0.1;\r\n        console.log(delta);\r\n        this._scene.emit(EasyControllerEvent.CAMERA_ZOOM, delta);\r\n    }\r\n\r\n    private key2dirMap = null;\r\n\r\n    updateDirection() {\r\n        if (this.key2dirMap == null) {\r\n            this.key2dirMap = {};\r\n            this.key2dirMap[0] = -1;\r\n            this.key2dirMap[KeyCode.KEY_A] = 180;\r\n            this.key2dirMap[KeyCode.KEY_D] = 0;\r\n            this.key2dirMap[KeyCode.KEY_W] = 90;\r\n            this.key2dirMap[KeyCode.KEY_S] = 270;\r\n\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_A] = 135;\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_D] = 45;\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_A] = 225;\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_D] = 315;\r\n\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_D] = this.key2dirMap[KeyCode.KEY_D];\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_A] = this.key2dirMap[KeyCode.KEY_A];\r\n            this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S];\r\n            this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W];\r\n        }\r\n        let keyCode0 = this._keys[this._keys.length - 1] || 0;\r\n        let keyCode1 = this._keys[this._keys.length - 2] || 0;\r\n        this._degree = this.key2dirMap[keyCode1 * 1000 + keyCode0];\r\n        if (this._degree == null || this._degree < 0) {\r\n            this._scene.emit(EasyControllerEvent.MOVEMENT_STOP);\r\n        }\r\n        else {\r\n            this._scene.emit(EasyControllerEvent.MOVEMENT, this._degree, 1.0);\r\n        }\r\n    }\r\n}"]}